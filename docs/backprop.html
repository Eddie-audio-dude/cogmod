<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Learning useful representations – Computational Cognitive Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./learning.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ebrw.html">Coupling behavior to structured representations</a></li><li class="breadcrumb-item"><a href="./backprop.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Learning useful representations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Computational Cognitive Models</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Background</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r_coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Programming with R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Modeling behavior</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./random_walk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Building a random walk model to simulate choice and RT</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diffusion_sim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">From random walk to diffusion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diffusion_fit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fitting a diffusion model to data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model_comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Model complexity and model comparison</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./blast_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">A worked example</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accumulator_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Accumulator models of choice and response time</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Coupling behavior to structured representations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ebrw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exemplar of the Exemplar Based Random Walk</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vector_reps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Distributed representations, similarity, and recognition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Associative Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./backprop.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Learning useful representations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#backpropagation-of-error" id="toc-backpropagation-of-error" class="nav-link active" data-scroll-target="#backpropagation-of-error"><span class="header-section-number">12.1</span> Backpropagation of error</a>
  <ul class="collapse">
  <li><a href="#forward-propagation" id="toc-forward-propagation" class="nav-link" data-scroll-target="#forward-propagation"><span class="header-section-number">12.1.1</span> Forward propagation</a></li>
  <li><a href="#backward-propagation" id="toc-backward-propagation" class="nav-link" data-scroll-target="#backward-propagation"><span class="header-section-number">12.1.2</span> Backward propagation</a></li>
  <li><a href="#baseline-activations" id="toc-baseline-activations" class="nav-link" data-scroll-target="#baseline-activations"><span class="header-section-number">12.1.3</span> Baseline activations</a></li>
  </ul></li>
  <li><a href="#learning-concept-representations-from-properties" id="toc-learning-concept-representations-from-properties" class="nav-link" data-scroll-target="#learning-concept-representations-from-properties"><span class="header-section-number">12.2</span> Learning concept representations from properties</a></li>
  <li><a href="#autoencoders-for-learning-co-occurrence-patterns" id="toc-autoencoders-for-learning-co-occurrence-patterns" class="nav-link" data-scroll-target="#autoencoders-for-learning-co-occurrence-patterns"><span class="header-section-number">12.3</span> Autoencoders for learning co-occurrence patterns</a></li>
  <li><a href="#simple-recurrent-networks-learning-patterns-in-time" id="toc-simple-recurrent-networks-learning-patterns-in-time" class="nav-link" data-scroll-target="#simple-recurrent-networks-learning-patterns-in-time"><span class="header-section-number">12.4</span> Simple recurrent networks: Learning patterns in time</a>
  <ul class="collapse">
  <li><a href="#learning-to-have-memory" id="toc-learning-to-have-memory" class="nav-link" data-scroll-target="#learning-to-have-memory"><span class="header-section-number">12.4.1</span> Learning to have memory</a></li>
  <li><a href="#learning-concept-representations-by-prediction" id="toc-learning-concept-representations-by-prediction" class="nav-link" data-scroll-target="#learning-concept-representations-by-prediction"><span class="header-section-number">12.4.2</span> Learning concept representations by prediction</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ebrw.html">Coupling behavior to structured representations</a></li><li class="breadcrumb-item"><a href="./backprop.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Learning useful representations</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Learning useful representations</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In the previous chapter, we looked at models that <em>learned</em> by adjusting a matrix of <em>associative weights</em> between two sets of nodes. In those models, knowledge was <em>represented</em> by the entries in that matrix, reflecting the degree to which event features would “activate” other nodes. We saw that one powerful form of learning was <em>error-driven learning</em> where weight adjustments were made explicitly for the purpose of reducing the error between the learner’s predictions/expectations and what actually transpired.</p>
<p>The models in this chapter also learn by attempting to minimize error and they also do so by adjusting entries in associative weight matrices. However, these models add a so-called “hidden layer” that intervenes between the event features that act as “input” and the predictions/expectations that act as “output”. This category of model was the core of the <strong>connectionist</strong> or <strong>parallel distributed processing (PDP)</strong> framework.</p>
<p>These models learn via an extended form of error-driven learning called <strong>backpropagation of error</strong> <span class="citation" data-cites="RumelhartHintonWilliams1986">(<a href="references.html#ref-RumelhartHintonWilliams1986" role="doc-biblioref">Rumelhart et al., 1986</a>)</span>. This learning procedure enables a model to learn how to form an <em>internal representation</em> of the events it encounters, in the form of a <em>pattern of activation</em> across the nodes of its “hidden layer”. Such representations are a form of integral distributed vector representation. The purpose of these representations is to re-encode the features of an event into a form that enables the model to make more correct predictions/actions.</p>
<p>The kinds of models we will see in this chapter can thus be viewed as psychological theories of <em>how</em> distributed vector representations are acquired via experience. As we have already seen these representations are themselves essential for understanding performance (choice and RT) in different cognitive tasks. So these models “peel back” one more layer of the cognitive onion to help us understand where those representations may have come from.</p>
<p>Unfortunately, as we shall see (and as was explicitly stated by the developers of these models), learning by backpropagation of error is not very biologically plausible. So while these models are often called “artificial neural networks”, the resemblance between them and real neurons should be viewed in only an abstract sense.</p>
<p>Another drawback with these models is that learning requires extensive experience before the associative weights in the network stabilize and stop getting adjusted. As a result, this form of learning should not be thought of as something that happens on short timescales. Indeed, it has been proposed by several authors that biological brains have two <em>complementary learning systems</em> <span class="citation" data-cites="McClellandEtAl1995">(<a href="references.html#ref-McClellandEtAl1995" role="doc-biblioref">McClelland et al., 1995</a>)</span>. There is a “fast” learning system—typically thought to depend on the hippocampus and other medial temporal lobe structures—that encodes distinct events as separate traces, like we saw with the EBRW. Meanwhile, there is also a “slow” learning system—typically thought to depend on cortical areas—that does the kind of gradual weight adjustment we will see in the models in this chapter. The fast learning system encodes separate traces for distinct events using distributed representations learned by the slow learning system.</p>
<section id="backpropagation-of-error" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="backpropagation-of-error"><span class="header-section-number">12.1</span> Backpropagation of error</h2>
<p>The models we will examine in this chapter all have the basic structure depicted in the graph below:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 278.00 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 274,-184 274,4 -4,4"></polygon>
<!-- i1 -->
<g id="node1" class="node">
<title>i1</title>
<ellipse fill="none" stroke="black" cx="171" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="171" y="-157.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">i1</text>
</g>
<!-- h1 -->
<g id="node2" class="node">
<title>h1</title>
<ellipse fill="none" stroke="black" cx="63" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="63" y="-85.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">h1</text>
</g>
<!-- i1&#45;&gt;h1 -->
<g id="edge1" class="edge">
<title>i1-&gt;h1</title>
<path fill="none" stroke="black" d="M152.19,-148.81C135,-137.67 109.38,-121.06 90.01,-108.5"></path>
<polygon fill="black" stroke="black" points="91.89,-105.56 81.6,-103.05 88.08,-111.43 91.89,-105.56"></polygon>
</g>
<!-- h2 -->
<g id="node3" class="node">
<title>h2</title>
<ellipse fill="none" stroke="black" cx="135" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="135" y="-85.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">h2</text>
</g>
<!-- i1&#45;&gt;h2 -->
<g id="edge2" class="edge">
<title>i1-&gt;h2</title>
<path fill="none" stroke="black" d="M162.65,-144.76C158.29,-136.28 152.85,-125.71 147.96,-116.2"></path>
<polygon fill="black" stroke="black" points="150.99,-114.44 143.3,-107.15 144.77,-117.64 150.99,-114.44"></polygon>
</g>
<!-- h3 -->
<g id="node4" class="node">
<title>h3</title>
<ellipse fill="none" stroke="black" cx="207" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="207" y="-85.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">h3</text>
</g>
<!-- i1&#45;&gt;h3 -->
<g id="edge3" class="edge">
<title>i1-&gt;h3</title>
<path fill="none" stroke="black" d="M179.35,-144.76C183.71,-136.28 189.15,-125.71 194.04,-116.2"></path>
<polygon fill="black" stroke="black" points="197.23,-117.64 198.7,-107.15 191.01,-114.44 197.23,-117.64"></polygon>
</g>
<!-- o1 -->
<g id="node8" class="node">
<title>o1</title>
<ellipse fill="none" stroke="black" cx="99" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-13.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">o1</text>
</g>
<!-- h1&#45;&gt;o1 -->
<g id="edge13" class="edge">
<title>h1-&gt;o1</title>
<path fill="none" stroke="black" d="M71.35,-72.76C75.71,-64.28 81.15,-53.71 86.04,-44.2"></path>
<polygon fill="black" stroke="black" points="89.23,-45.64 90.7,-35.15 83.01,-42.44 89.23,-45.64"></polygon>
</g>
<!-- o2 -->
<g id="node9" class="node">
<title>o2</title>
<ellipse fill="none" stroke="black" cx="171" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="171" y="-13.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">o2</text>
</g>
<!-- h1&#45;&gt;o2 -->
<g id="edge14" class="edge">
<title>h1-&gt;o2</title>
<path fill="none" stroke="black" d="M81.81,-76.81C99,-65.67 124.62,-49.06 143.99,-36.5"></path>
<polygon fill="black" stroke="black" points="145.92,-39.43 152.4,-31.05 142.11,-33.56 145.92,-39.43"></polygon>
</g>
<!-- h2&#45;&gt;o1 -->
<g id="edge15" class="edge">
<title>h2-&gt;o1</title>
<path fill="none" stroke="black" d="M126.65,-72.76C122.29,-64.28 116.85,-53.71 111.96,-44.2"></path>
<polygon fill="black" stroke="black" points="114.99,-42.44 107.3,-35.15 108.77,-45.64 114.99,-42.44"></polygon>
</g>
<!-- h2&#45;&gt;o2 -->
<g id="edge16" class="edge">
<title>h2-&gt;o2</title>
<path fill="none" stroke="black" d="M143.35,-72.76C147.71,-64.28 153.15,-53.71 158.04,-44.2"></path>
<polygon fill="black" stroke="black" points="161.23,-45.64 162.7,-35.15 155.01,-42.44 161.23,-45.64"></polygon>
</g>
<!-- h3&#45;&gt;o1 -->
<g id="edge17" class="edge">
<title>h3-&gt;o1</title>
<path fill="none" stroke="black" d="M188.19,-76.81C171,-65.67 145.38,-49.06 126.01,-36.5"></path>
<polygon fill="black" stroke="black" points="127.89,-33.56 117.6,-31.05 124.08,-39.43 127.89,-33.56"></polygon>
</g>
<!-- h3&#45;&gt;o2 -->
<g id="edge18" class="edge">
<title>h3-&gt;o2</title>
<path fill="none" stroke="black" d="M198.65,-72.76C194.29,-64.28 188.85,-53.71 183.96,-44.2"></path>
<polygon fill="black" stroke="black" points="186.99,-42.44 179.3,-35.15 180.77,-45.64 186.99,-42.44"></polygon>
</g>
<!-- i2 -->
<g id="node5" class="node">
<title>i2</title>
<ellipse fill="none" stroke="black" cx="243" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="243" y="-157.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">i2</text>
</g>
<!-- i2&#45;&gt;h1 -->
<g id="edge4" class="edge">
<title>i2-&gt;h1</title>
<path fill="none" stroke="black" d="M221.87,-150.51C217.03,-148.25 211.88,-145.96 207,-144 160.04,-125.16 145.96,-126.84 99,-108 97.17,-107.27 95.3,-106.49 93.43,-105.68"></path>
<polygon fill="black" stroke="black" points="94.69,-102.41 84.13,-101.49 91.82,-108.79 94.69,-102.41"></polygon>
</g>
<!-- i2&#45;&gt;h2 -->
<g id="edge5" class="edge">
<title>i2-&gt;h2</title>
<path fill="none" stroke="black" d="M224.19,-148.81C207,-137.67 181.38,-121.06 162.01,-108.5"></path>
<polygon fill="black" stroke="black" points="163.89,-105.56 153.6,-103.05 160.08,-111.43 163.89,-105.56"></polygon>
</g>
<!-- i2&#45;&gt;h3 -->
<g id="edge6" class="edge">
<title>i2-&gt;h3</title>
<path fill="none" stroke="black" d="M234.65,-144.76C230.29,-136.28 224.85,-125.71 219.96,-116.2"></path>
<polygon fill="black" stroke="black" points="222.99,-114.44 215.3,-107.15 216.77,-117.64 222.99,-114.44"></polygon>
</g>
<!-- i3 -->
<g id="node6" class="node">
<title>i3</title>
<ellipse fill="none" stroke="black" cx="27" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-157.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">i3</text>
</g>
<!-- i3&#45;&gt;h1 -->
<g id="edge7" class="edge">
<title>i3-&gt;h1</title>
<path fill="none" stroke="black" d="M35.35,-144.76C39.71,-136.28 45.15,-125.71 50.04,-116.2"></path>
<polygon fill="black" stroke="black" points="53.23,-117.64 54.7,-107.15 47.01,-114.44 53.23,-117.64"></polygon>
</g>
<!-- i3&#45;&gt;h2 -->
<g id="edge8" class="edge">
<title>i3-&gt;h2</title>
<path fill="none" stroke="black" d="M45.81,-148.81C63,-137.67 88.62,-121.06 107.99,-108.5"></path>
<polygon fill="black" stroke="black" points="109.92,-111.43 116.4,-103.05 106.11,-105.56 109.92,-111.43"></polygon>
</g>
<!-- i3&#45;&gt;h3 -->
<g id="edge9" class="edge">
<title>i3-&gt;h3</title>
<path fill="none" stroke="black" d="M48.13,-150.51C52.97,-148.25 58.12,-145.96 63,-144 109.96,-125.16 124.04,-126.84 171,-108 172.83,-107.27 174.7,-106.49 176.57,-105.68"></path>
<polygon fill="black" stroke="black" points="178.18,-108.79 185.87,-101.49 175.31,-102.41 178.18,-108.79"></polygon>
</g>
<!-- i4 -->
<g id="node7" class="node">
<title>i4</title>
<ellipse fill="none" stroke="black" cx="99" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-157.8" font-family="Helvetica,Arial,sans-serif" font-size="14.00">i4</text>
</g>
<!-- i4&#45;&gt;h1 -->
<g id="edge10" class="edge">
<title>i4-&gt;h1</title>
<path fill="none" stroke="black" d="M90.65,-144.76C86.29,-136.28 80.85,-125.71 75.96,-116.2"></path>
<polygon fill="black" stroke="black" points="78.99,-114.44 71.3,-107.15 72.77,-117.64 78.99,-114.44"></polygon>
</g>
<!-- i4&#45;&gt;h2 -->
<g id="edge11" class="edge">
<title>i4-&gt;h2</title>
<path fill="none" stroke="black" d="M107.35,-144.76C111.71,-136.28 117.15,-125.71 122.04,-116.2"></path>
<polygon fill="black" stroke="black" points="125.23,-117.64 126.7,-107.15 119.01,-114.44 125.23,-117.64"></polygon>
</g>
<!-- i4&#45;&gt;h3 -->
<g id="edge12" class="edge">
<title>i4-&gt;h3</title>
<path fill="none" stroke="black" d="M117.81,-148.81C135,-137.67 160.62,-121.06 179.99,-108.5"></path>
<polygon fill="black" stroke="black" points="181.92,-111.43 188.4,-103.05 178.11,-105.56 181.92,-111.43"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The circles represent the elements of different vector representations; each representation is referred to as a <em>layer</em>. The “i” nodes are elements of a vector that represents the “input”—this is a representation of a <em>learning event</em>, just like in the last chapter. The “o” nodes are elements of a vector that represents the action/prediction/expectation that the learner takes, again like we saw in the last chapter. The new thing are the “h” nodes, which represent the network’s <em>internal (hidden) representation</em> of the learning event.</p>
<p>The links between the nodes depict associative weights between them. In the previous chapter, we only had associative weights between “input” and “output”. In the models in this chapter, we consider two sets of associations represented by two matrices of associative weights. If there are <span class="math inline">\(D\)</span> input dimensions, <span class="math inline">\(H\)</span> hidden dimensions, and <span class="math inline">\(O\)</span> output dimensions, we can write the matrix of weights from input to hidden as <span class="math inline">\(W_{ih}\)</span> and the matrix of weights from hidden to output as <span class="math inline">\(W_{ho}\)</span>.</p>
<section id="forward-propagation" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="forward-propagation"><span class="header-section-number">12.1.1</span> Forward propagation</h3>
<p>Just like in the last chapter, we treat the pattern of activation on the output vector as a representation of what the learner expects or plans to do. The learner forms this representation by “propagating” the activity from the input layer to the hidden layer and then from the hidden layer to the output layer. Like last time, we can write that propagation process using some linear algebra: <span class="math display">\[\begin{align}
\mathbf{h} &amp; = f_h \left( \mathbf{x} W_{ih} \right) &amp; \text{Input to hidden} \\
\mathbf{o} &amp; = f_o \left( \mathbf{h} W_{ho} \right) &amp; \text{Hidden to output}
\end{align}\]</span> where <span class="math inline">\(\mathbf{x}\)</span> is the vector representing the learning event, <span class="math inline">\(\mathbf{h}\)</span> is the vector representing the pattern of activation at the hidden layer, and <span class="math inline">\(\mathbf{o}\)</span> is the vector representing the pattern of activation at the output layer. Notice that we allow for the activity at the hidden and output layers to be <em>functions</em> of their corresponding “inputs”, indicated by <span class="math inline">\(f_h \left( \cdot \right)\)</span> and <span class="math inline">\(f_o \left( \cdot \right)\)</span>. In this chapter, we will only look at models where both <span class="math inline">\(f_h\)</span> and <span class="math inline">\(f_o\)</span> are the <em>logistic function</em> we used last chapter, i.e., <span class="math display">\[
f_h(a) = f_o(a) = \frac{1}{1 + \exp \left(-a \right)}
\]</span></p>
</section>
<section id="backward-propagation" class="level3" data-number="12.1.2">
<h3 data-number="12.1.2" class="anchored" data-anchor-id="backward-propagation"><span class="header-section-number">12.1.2</span> Backward propagation</h3>
<p>The procedure above describes how the model forms an expectation <span class="math inline">\(\mathbf{o}\)</span> on the basis of the event features <span class="math inline">\(\mathbf{x}\)</span>. As we saw last time, the vector <span class="math inline">\(\mathbf{o}\)</span> can be treated as a vector of probabilities with which each output feature is expected to be present or not (since we are using the logistic function).</p>
<p>The model <em>learns</em> by first computing the error between its expectation and a “target” representation and then <em>propagating that error signal backwards along the associative weights</em>. That’s why this learning procedure is called “backward propagation”, or “backprop” for short (not to be confused with a lumbar support pillow).</p>
<p>To be more mathy about it, backprop essentially adds one step to the error-driven learning procedure we saw last time. The additional step is because we have to adjust <em>two</em> sets of associative weights, <span class="math inline">\(W_{ho}\)</span> and <span class="math inline">\(W_{ih}\)</span>. The equations below spell out the process: <span class="math display">\[\begin{align*}
\mathbf{e_o} &amp; = \mathbf{t} - \mathbf{o} &amp; \text{Error between target and output} \\
\mathbf{d_o} &amp; = \mathbf{e_o} \mathbf{o} \left(1 - \mathbf{o} \right) &amp; \text{Derivative of error with respect to output activation} \\
\Delta W_{ho} &amp; = \lambda_{ho} \left( \mathbf{h} \otimes \mathbf{d_o} \right) &amp; \text{How much to adjust hidden to output weights} \\
\mathbf{d_h} &amp; = W_{ho} \mathbf{e_o} \mathbf{h} \left(1 - \mathbf{h} \right) &amp; \text{Derivative of error with respect to hidden activation} \\
\Delta W_{ih} &amp; = \lambda_{ih} \left( \mathbf{x} \otimes \mathbf{d_h} \right) &amp; \text{How much to adjust input to hidden weights}
\end{align*}\]</span> You may notice above some stuff about “derivatives”, but this is not so mysterious as at may first appear. We were able to avoid mentioning derivatives in the last chapter because we only needed to worry about how to adjust a single set of weights. But really what we were doing was computing <em>how much the error would change if we adjusted each associative weight</em>. That’s a derivative! Now that we have two sets of weights to learn, we need to consider how much <em>each</em> weight contributes to the total error at the output layer. Backprop just expands this concept of the derivative so that it can assign “blame” for the error to each weight.</p>
<p>You may notice the terms <span class="math inline">\(\mathbf{o} \left(1 - \mathbf{o} \right)\)</span> and <span class="math inline">\(\mathbf{h} \left(1 - \mathbf{h} \right)\)</span> in the derivative formulae above. That’s because we also need to consider the derivative of the <em>link function</em> for each layer. The derivative of the logistic function <span class="math inline">\(f \left( a \right)\)</span>, which we are using for both the hidden and output layers, is just <span class="math inline">\(f \left(a \right) \left[1 - f \left(a \right) \right]\)</span>, hence the appearance of those terms in the formulae above.</p>
<p>Finally, although we could use different learning rates for input-to-hidden and hidden-to-output weights, denoted <span class="math inline">\(\lambda_{ih}\)</span> and <span class="math inline">\(\lambda_{ho}\)</span> respectively, in the models below we will just use a single learning rate <span class="math inline">\(\lambda\)</span> that applies to all weights.</p>
</section>
<section id="baseline-activations" class="level3" data-number="12.1.3">
<h3 data-number="12.1.3" class="anchored" data-anchor-id="baseline-activations"><span class="header-section-number">12.1.3</span> Baseline activations</h3>
<p>We will introduce one more aspect to these models that we did not employ earlier, which is the use of a “baseline” activity level for both the hidden and output layers. We can think of this baseline as like an intercept term in linear regression. And just like in linear regression, the intercept can be thought of as an “input” that has a constant value. These baseline levels will be learned just like the weights are, i.e., they will be adjusted so as to minimize error. Specifically, the learning rule is: <span class="math display">\[\begin{align*}
\Delta \mathbf{b_h} &amp; = \lambda \mathbf{d_h} \\
\Delta \mathbf{b_o} &amp; = \lambda \mathbf{d_o}
\end{align*}\]</span> where <span class="math inline">\(\mathbf{b_h}\)</span> and <span class="math inline">\(\mathbf{b_o}\)</span> are the baselines for the hidden and output units, respectively, and <span class="math inline">\(\mathbf{d_h}\)</span> and <span class="math inline">\(\mathbf{d_o}\)</span> are the vectors of error derivatives defined above.</p>
</section>
</section>
<section id="learning-concept-representations-from-properties" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="learning-concept-representations-from-properties"><span class="header-section-number">12.2</span> Learning concept representations from properties</h2>
<p>Now let’s see how one of these models works in a setting we have already seen. The example below shows how a simple backprop network can learn to represent the different concepts we saw in some of our preceding examples. Specifically, we will train the network to learn the features of different concepts. Each learning event will be represented with a localist vector representation of a concept. The output that the network will be trained to produce is a separable vector representation of the <em>features</em> of that concept. Thus, the network will learn to report the features of a concept, given the concept as a “cue”. We can think of this as like learning to provide a dictionary definition of a term.</p>
<p>What we are particularly interested in is the <em>dynamics</em> by which the network learns representations for the eight concepts. As we shall see, the representation that the network learns in its hidden layer will distinguish between broad categories early on and later come to make more fine-grained distinctions. This gradual differentiation over the course of learning is a natural consequence of error-driven learning: Since the biggest errors are due to the biggest confusions, those will be learned first.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>logistic_act <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>x)))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Localist representations of eight concepts</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>     <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">8</span>, <span class="at">ncol =</span> <span class="dv">8</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"pine"</span>, <span class="st">"oak"</span>, <span class="st">"rose"</span>, <span class="st">"daisy"</span>, <span class="st">"robin"</span>, <span class="st">"canary"</span>, <span class="st">"sunfish"</span>, <span class="st">"salmon"</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"pine"</span>, <span class="st">"oak"</span>, <span class="st">"rose"</span>, <span class="st">"daisy"</span>, <span class="st">"robin"</span>, <span class="st">"canary"</span>, <span class="st">"sunfish"</span>, <span class="st">"salmon"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Separable representations of concept features</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>     <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">8</span>, <span class="at">ncol =</span> <span class="dv">22</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"pine"</span>, <span class="st">"oak"</span>, <span class="st">"rose"</span>, <span class="st">"daisy"</span>, <span class="st">"robin"</span>, <span class="st">"canary"</span>, <span class="st">"sunfish"</span>, <span class="st">"salmon"</span>),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"is_green"</span>, <span class="st">"has_leaves"</span>, <span class="st">"is_red"</span>, <span class="st">"is_yellow"</span>, <span class="st">"can_sing"</span>, <span class="st">"has_bark"</span>, <span class="st">"is_big"</span>, <span class="st">"has_branches"</span>, <span class="st">"has_leaves"</span>, <span class="st">"has_petals"</span>, <span class="st">"is_pretty"</span>, <span class="st">"has_feathers"</span>, <span class="st">"can_fly"</span>, <span class="st">"has_wings"</span>, <span class="st">"has_scales"</span>, <span class="st">"can_swim"</span>, <span class="st">"has_gills"</span>, <span class="st">"has_roots"</span>, <span class="st">"can_move"</span>, <span class="st">"has_skin"</span>, <span class="st">"can_grow"</span>, <span class="st">"is_living"</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>n_hidden <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>n_epochs <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>learn_by_epoch <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>n_hidden_snapshots <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>epoch_to_snap <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">log</span>(n_epochs), <span class="at">length.out =</span> n_hidden_snapshots)))</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>snapshot_hidden_activation <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(n_hidden_snapshots, <span class="fu">nrow</span>(event), n_hidden), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"epoch"</span> <span class="ot">=</span> epoch_to_snap, <span class="st">"item"</span> <span class="ot">=</span> <span class="fu">rownames</span>(event), <span class="st">"hidden_unit"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n_hidden))</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>i_to_h_assc_weights <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">ncol</span>(event) <span class="sc">*</span> n_hidden), <span class="at">nrow =</span> <span class="fu">ncol</span>(event), <span class="at">ncol =</span> n_hidden) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>h_to_o_assc_weights <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> n_hidden <span class="sc">*</span> <span class="fu">ncol</span>(target)), <span class="at">nrow =</span> n_hidden, <span class="at">ncol =</span> <span class="fu">ncol</span>(target)) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>hidden_baseline <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_hidden) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>output_baseline <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">ncol</span>(target)) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (epoch <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_epochs) {</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    training_order <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(event))</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    d_h_to_o <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> h_to_o_assc_weights</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    d_i_to_h <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> i_to_h_assc_weights</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    d_h_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> hidden_baseline</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    d_o_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> output_baseline</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> training_order) {</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Forward propagation (prediction)</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Note the use of `as.vector` to ensure result is a vector (not a matrix with a single row)</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        hidden_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(event[i,] <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>        output_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(hidden_activation <span class="sc">%*%</span> h_to_o_assc_weights) <span class="sc">+</span> output_baseline)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute error at output layer</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        output_error <span class="ot">&lt;-</span> target[i,] <span class="sc">-</span> output_activation</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Back propagation (learning)</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Derivative of error with respect to output unit activation</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        d_output_error <span class="ot">&lt;-</span> output_error <span class="sc">*</span> output_activation <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> output_activation)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Derivative of error with respect to hidden unit activation</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        d_hidden_error <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(h_to_o_assc_weights <span class="sc">%*%</span> d_output_error) <span class="sc">*</span> hidden_activation <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> hidden_activation)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the associative weights between the hidden and output layers</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        d_h_to_o <span class="ot">&lt;-</span> d_h_to_o <span class="sc">+</span> learning_rate <span class="sc">*</span> <span class="fu">outer</span>(hidden_activation, d_output_error)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the associative weights between the input and hidden layers</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        d_i_to_h <span class="ot">&lt;-</span> d_i_to_h <span class="sc">+</span> learning_rate <span class="sc">*</span> <span class="fu">outer</span>(event[i,], d_hidden_error)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the baseline of the output units</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        d_o_baseline <span class="ot">&lt;-</span> learning_rate <span class="sc">*</span> d_output_error</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the baseline of the hidden units</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        d_h_baseline <span class="ot">&lt;-</span> learning_rate <span class="sc">*</span> d_hidden_error</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span>learn_by_epoch) {</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adjust weights</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>            i_to_h_assc_weights <span class="ot">&lt;-</span> i_to_h_assc_weights <span class="sc">+</span> d_i_to_h</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>            h_to_o_assc_weights <span class="ot">&lt;-</span> h_to_o_assc_weights <span class="sc">+</span> d_h_to_o</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>            hidden_baseline <span class="ot">&lt;-</span> hidden_baseline <span class="sc">+</span> d_h_baseline</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>            output_baseline <span class="ot">&lt;-</span> output_baseline <span class="sc">+</span> d_o_baseline</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Reset adjustment to zero</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>            d_h_to_o <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> h_to_o_assc_weights</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>            d_i_to_h <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> i_to_h_assc_weights</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>            d_h_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> hidden_baseline</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>            d_o_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> output_baseline</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (learn_by_epoch) {</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adjust weights</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        i_to_h_assc_weights <span class="ot">&lt;-</span> i_to_h_assc_weights <span class="sc">+</span> d_i_to_h</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        h_to_o_assc_weights <span class="ot">&lt;-</span> h_to_o_assc_weights <span class="sc">+</span> d_h_to_o</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        hidden_baseline <span class="ot">&lt;-</span> hidden_baseline <span class="sc">+</span> d_h_baseline</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        output_baseline <span class="ot">&lt;-</span> output_baseline <span class="sc">+</span> d_o_baseline</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (epoch <span class="sc">%in%</span> <span class="fu">as.numeric</span>(<span class="fu">dimnames</span>(snapshot_hidden_activation)[[<span class="dv">1</span>]])) {</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(event)) {</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>            snapshot_hidden_activation[<span class="fu">as.character</span>(epoch), i, ] <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(event[i,] <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="fu">array2DF</span>(snapshot_hidden_activation) <span class="sc">%&gt;%</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">item =</span> <span class="fu">factor</span>(item, <span class="at">levels =</span> <span class="fu">rownames</span>(event))) <span class="sc">%&gt;%</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hidden_unit =</span> <span class="fu">as.numeric</span>(hidden_unit)) <span class="sc">%&gt;%</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">epoch =</span> <span class="fu">factor</span>(epoch, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(epoch)))))) <span class="sc">%&gt;%</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hidden_unit, <span class="at">y =</span> Value, <span class="at">color =</span> item)) <span class="sc">+</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Paired"</span>) <span class="sc">+</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="st">"epoch"</span>, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="backprop_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>item_mds <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(n_hidden_snapshots, <span class="fu">nrow</span>(event), <span class="dv">2</span>), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"epoch"</span> <span class="ot">=</span> epoch_to_snap, <span class="st">"item"</span> <span class="ot">=</span> <span class="fu">rownames</span>(event), <span class="st">"dim"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"dim"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (epoch <span class="cf">in</span> <span class="fu">dimnames</span>(snapshot_hidden_activation)[[<span class="dv">1</span>]]) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    item_mds[epoch, , ] <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(<span class="at">d =</span> <span class="fu">dist</span>(snapshot_hidden_activation[epoch,,]), <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">array2DF</span>(item_mds) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(epoch, item), <span class="at">names_from =</span> dim, <span class="at">values_from =</span> Value) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">item =</span> <span class="fu">factor</span>(item, <span class="at">levels =</span> <span class="fu">rownames</span>(event))) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">epoch =</span> <span class="fu">factor</span>(epoch, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(epoch)))))) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dim1, <span class="at">y =</span> dim2, <span class="at">color =</span> item)) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Paired"</span>) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evolution of internal representations with learning"</span>, <span class="at">x =</span> <span class="st">"Dimension 1"</span>, <span class="at">y =</span> <span class="st">"Dimension 2"</span>, <span class="at">caption =</span> <span class="st">"Visualization by multidimensional scaling"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="backprop_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model was trained in “batches”, like we saw last time, only those batches are referred to as “epochs”, following some rather grandiose terminology from the early days of such models. The code above takes “snapshots” of the hidden unit activations at various epochs during learning so we can examine gradual differentiation of the eight concepts. To get these snapshots, we cue the network with the vector representation of a concept and forward-propagate that activation into the hidden layer. The vector of activation values among the hidden units, <span class="math inline">\(\mathbf{h}\)</span>, is treated as a vector representation of that concept.</p>
<p>A common visualization technique in this domain is to use multidimensional scaling to plot the vector representations derived from the hidden layer in two dimensions. As you can see, the model learns first to distinguish animals and plants, then the subcategories of animals and plants, and finally individual animals within each subcategory. Again, this is a natural consequence of error-driven learning, but also mirrors the developmental trajectories by which many human learners acquire concepts <span class="citation" data-cites="RogersMcClelland2004">(<a href="references.html#ref-RogersMcClelland2004" role="doc-biblioref">Rogers &amp; McClelland, 2004</a>)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>transfer_event <span class="ot">&lt;-</span> event</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>transfer_hidden_activation <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(transfer_event), <span class="at">ncol =</span> n_hidden, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">rownames</span>(transfer_event), <span class="dv">1</span><span class="sc">:</span>n_hidden))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>p_resp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(transfer_event), <span class="at">ncol =</span> <span class="fu">ncol</span>(target), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">rownames</span>(transfer_event), <span class="fu">colnames</span>(target)))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(transfer_event)) {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    transfer_hidden_activation[i,] <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(transfer_event[i,] <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    p_resp[i,] <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(transfer_hidden_activation[i,] <span class="sc">%*%</span> h_to_o_assc_weights) <span class="sc">+</span> output_baseline)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(p_resp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">is_green</th>
<th style="text-align: right;">has_leaves</th>
<th style="text-align: right;">is_red</th>
<th style="text-align: right;">is_yellow</th>
<th style="text-align: right;">can_sing</th>
<th style="text-align: right;">has_bark</th>
<th style="text-align: right;">is_big</th>
<th style="text-align: right;">has_branches</th>
<th style="text-align: right;">has_leaves</th>
<th style="text-align: right;">has_petals</th>
<th style="text-align: right;">is_pretty</th>
<th style="text-align: right;">has_feathers</th>
<th style="text-align: right;">can_fly</th>
<th style="text-align: right;">has_wings</th>
<th style="text-align: right;">has_scales</th>
<th style="text-align: right;">can_swim</th>
<th style="text-align: right;">has_gills</th>
<th style="text-align: right;">has_roots</th>
<th style="text-align: right;">can_move</th>
<th style="text-align: right;">has_skin</th>
<th style="text-align: right;">can_grow</th>
<th style="text-align: right;">is_living</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pine</td>
<td style="text-align: right;">0.6197004</td>
<td style="text-align: right;">0.2152856</td>
<td style="text-align: right;">0.1634120</td>
<td style="text-align: right;">0.0023826</td>
<td style="text-align: right;">0.0000787</td>
<td style="text-align: right;">0.9250800</td>
<td style="text-align: right;">0.9248442</td>
<td style="text-align: right;">0.9249413</td>
<td style="text-align: right;">0.0654654</td>
<td style="text-align: right;">0.0653810</td>
<td style="text-align: right;">0.0655194</td>
<td style="text-align: right;">0.0003422</td>
<td style="text-align: right;">0.0003460</td>
<td style="text-align: right;">0.0003463</td>
<td style="text-align: right;">0.0290274</td>
<td style="text-align: right;">0.0291252</td>
<td style="text-align: right;">0.0290503</td>
<td style="text-align: right;">0.9841509</td>
<td style="text-align: right;">0.0158996</td>
<td style="text-align: right;">0.0159508</td>
<td style="text-align: right;">0.9934424</td>
<td style="text-align: right;">0.9934167</td>
</tr>
<tr class="even">
<td style="text-align: left;">oak</td>
<td style="text-align: right;">0.3639541</td>
<td style="text-align: right;">0.7542412</td>
<td style="text-align: right;">0.0035378</td>
<td style="text-align: right;">0.0604771</td>
<td style="text-align: right;">0.0016651</td>
<td style="text-align: right;">0.9710283</td>
<td style="text-align: right;">0.9711196</td>
<td style="text-align: right;">0.9710512</td>
<td style="text-align: right;">0.0327099</td>
<td style="text-align: right;">0.0327668</td>
<td style="text-align: right;">0.0326952</td>
<td style="text-align: right;">0.0006676</td>
<td style="text-align: right;">0.0006763</td>
<td style="text-align: right;">0.0006762</td>
<td style="text-align: right;">0.0327475</td>
<td style="text-align: right;">0.0326825</td>
<td style="text-align: right;">0.0327317</td>
<td style="text-align: right;">0.9800315</td>
<td style="text-align: right;">0.0200837</td>
<td style="text-align: right;">0.0200627</td>
<td style="text-align: right;">0.9852742</td>
<td style="text-align: right;">0.9852162</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rose</td>
<td style="text-align: right;">0.1171546</td>
<td style="text-align: right;">0.0051179</td>
<td style="text-align: right;">0.8592013</td>
<td style="text-align: right;">0.0786542</td>
<td style="text-align: right;">0.0023262</td>
<td style="text-align: right;">0.0339779</td>
<td style="text-align: right;">0.0337560</td>
<td style="text-align: right;">0.0338263</td>
<td style="text-align: right;">0.9526771</td>
<td style="text-align: right;">0.9526321</td>
<td style="text-align: right;">0.9527004</td>
<td style="text-align: right;">0.0370967</td>
<td style="text-align: right;">0.0370953</td>
<td style="text-align: right;">0.0370894</td>
<td style="text-align: right;">0.0009683</td>
<td style="text-align: right;">0.0009861</td>
<td style="text-align: right;">0.0009683</td>
<td style="text-align: right;">0.9703105</td>
<td style="text-align: right;">0.0296178</td>
<td style="text-align: right;">0.0296769</td>
<td style="text-align: right;">0.9930061</td>
<td style="text-align: right;">0.9930950</td>
</tr>
<tr class="even">
<td style="text-align: left;">daisy</td>
<td style="text-align: right;">0.0253838</td>
<td style="text-align: right;">0.0450993</td>
<td style="text-align: right;">0.0555032</td>
<td style="text-align: right;">0.9082180</td>
<td style="text-align: right;">0.0622958</td>
<td style="text-align: right;">0.0514525</td>
<td style="text-align: right;">0.0517702</td>
<td style="text-align: right;">0.0516991</td>
<td style="text-align: right;">0.9389191</td>
<td style="text-align: right;">0.9389509</td>
<td style="text-align: right;">0.9388634</td>
<td style="text-align: right;">0.0445643</td>
<td style="text-align: right;">0.0445280</td>
<td style="text-align: right;">0.0445385</td>
<td style="text-align: right;">0.0015944</td>
<td style="text-align: right;">0.0016179</td>
<td style="text-align: right;">0.0015916</td>
<td style="text-align: right;">0.9610207</td>
<td style="text-align: right;">0.0388918</td>
<td style="text-align: right;">0.0388536</td>
<td style="text-align: right;">0.9854807</td>
<td style="text-align: right;">0.9857238</td>
</tr>
<tr class="odd">
<td style="text-align: left;">robin</td>
<td style="text-align: right;">0.0592497</td>
<td style="text-align: right;">0.0018862</td>
<td style="text-align: right;">0.9673368</td>
<td style="text-align: right;">0.0214734</td>
<td style="text-align: right;">0.0703603</td>
<td style="text-align: right;">0.0076952</td>
<td style="text-align: right;">0.0074745</td>
<td style="text-align: right;">0.0074523</td>
<td style="text-align: right;">0.0352395</td>
<td style="text-align: right;">0.0352719</td>
<td style="text-align: right;">0.0352792</td>
<td style="text-align: right;">0.9347017</td>
<td style="text-align: right;">0.9348090</td>
<td style="text-align: right;">0.9347979</td>
<td style="text-align: right;">0.0373993</td>
<td style="text-align: right;">0.0373436</td>
<td style="text-align: right;">0.0374353</td>
<td style="text-align: right;">0.0433034</td>
<td style="text-align: right;">0.9567807</td>
<td style="text-align: right;">0.9567997</td>
<td style="text-align: right;">0.9878454</td>
<td style="text-align: right;">0.9877362</td>
</tr>
<tr class="even">
<td style="text-align: left;">canary</td>
<td style="text-align: right;">0.0026075</td>
<td style="text-align: right;">0.0145775</td>
<td style="text-align: right;">0.0436665</td>
<td style="text-align: right;">0.9792545</td>
<td style="text-align: right;">0.8833943</td>
<td style="text-align: right;">0.0039277</td>
<td style="text-align: right;">0.0039028</td>
<td style="text-align: right;">0.0038735</td>
<td style="text-align: right;">0.0438923</td>
<td style="text-align: right;">0.0439235</td>
<td style="text-align: right;">0.0438537</td>
<td style="text-align: right;">0.9448623</td>
<td style="text-align: right;">0.9447779</td>
<td style="text-align: right;">0.9447972</td>
<td style="text-align: right;">0.0529522</td>
<td style="text-align: right;">0.0529290</td>
<td style="text-align: right;">0.0529405</td>
<td style="text-align: right;">0.0255592</td>
<td style="text-align: right;">0.9744926</td>
<td style="text-align: right;">0.9743351</td>
<td style="text-align: right;">0.9806805</td>
<td style="text-align: right;">0.9806508</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sunfish</td>
<td style="text-align: right;">0.0099680</td>
<td style="text-align: right;">0.0281456</td>
<td style="text-align: right;">0.0288670</td>
<td style="text-align: right;">0.9513678</td>
<td style="text-align: right;">0.0739919</td>
<td style="text-align: right;">0.0286904</td>
<td style="text-align: right;">0.0290737</td>
<td style="text-align: right;">0.0290171</td>
<td style="text-align: right;">0.0039767</td>
<td style="text-align: right;">0.0039643</td>
<td style="text-align: right;">0.0039774</td>
<td style="text-align: right;">0.0403594</td>
<td style="text-align: right;">0.0403262</td>
<td style="text-align: right;">0.0402801</td>
<td style="text-align: right;">0.9442030</td>
<td style="text-align: right;">0.9443196</td>
<td style="text-align: right;">0.9441888</td>
<td style="text-align: right;">0.0235738</td>
<td style="text-align: right;">0.9763927</td>
<td style="text-align: right;">0.9763234</td>
<td style="text-align: right;">0.9860802</td>
<td style="text-align: right;">0.9860688</td>
</tr>
<tr class="even">
<td style="text-align: left;">salmon</td>
<td style="text-align: right;">0.1096960</td>
<td style="text-align: right;">0.0026860</td>
<td style="text-align: right;">0.9250481</td>
<td style="text-align: right;">0.0347728</td>
<td style="text-align: right;">0.0020557</td>
<td style="text-align: right;">0.0254518</td>
<td style="text-align: right;">0.0253029</td>
<td style="text-align: right;">0.0253500</td>
<td style="text-align: right;">0.0029490</td>
<td style="text-align: right;">0.0029360</td>
<td style="text-align: right;">0.0029553</td>
<td style="text-align: right;">0.0519291</td>
<td style="text-align: right;">0.0519060</td>
<td style="text-align: right;">0.0519225</td>
<td style="text-align: right;">0.9519660</td>
<td style="text-align: right;">0.9519600</td>
<td style="text-align: right;">0.9519801</td>
<td style="text-align: right;">0.0195692</td>
<td style="text-align: right;">0.9803492</td>
<td style="text-align: right;">0.9804679</td>
<td style="text-align: right;">0.9909340</td>
<td style="text-align: right;">0.9908830</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Finally, the code above verifies that the model has, indeed, learned to correctly predict the features of each concept.</p>
</section>
<section id="autoencoders-for-learning-co-occurrence-patterns" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="autoencoders-for-learning-co-occurrence-patterns"><span class="header-section-number">12.3</span> Autoencoders for learning co-occurrence patterns</h2>
<p>Just like in the last chapter, backprop networks can learn to reproduce patterns. Such networks are called <em>autoencoders</em>. The only difference between the following example and the one above is that the target output is the same vector as the input. The value of backprop in this instance is that the network can learn a <em>reduced</em> representation that takes advantage of redundancies or patterns within the input vectors. This is conceptually similar to how principal components analysis works!</p>
<p>The example below uses the disease symptoms from last chapter. Notice that the last two symptoms, discolored gums and nosebleed, are correlated—they are either both present or both absent. Thus, even though the hidden layer only has 3 dimensions instead of 4, the model can correctly reproduce the pattern of symptoms for each patient.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>logistic_act <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>x)))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">8</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"EM"</span>, <span class="st">"RM"</span>, <span class="st">"JJ"</span>, <span class="st">"LF"</span>, <span class="st">"AM"</span>, <span class="st">"JS"</span>, <span class="st">"ST"</span>, <span class="st">"SE"</span>),</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"swollen_eyelids"</span>, <span class="st">"splotchy_ears"</span>, <span class="st">"discolored_gums"</span>, <span class="st">"nosebleed"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> event</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>n_hidden <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>n_epochs <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>learn_by_epoch <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>n_hidden_snapshots <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>epoch_to_snap <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">log</span>(n_epochs), <span class="at">length.out =</span> n_hidden_snapshots)))</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>snapshot_hidden_activation <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(n_hidden_snapshots, <span class="fu">nrow</span>(event), n_hidden), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"epoch"</span> <span class="ot">=</span> epoch_to_snap, <span class="st">"item"</span> <span class="ot">=</span> <span class="fu">rownames</span>(event), <span class="st">"hidden_unit"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n_hidden))</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>i_to_h_assc_weights <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">ncol</span>(event) <span class="sc">*</span> n_hidden), <span class="at">nrow =</span> <span class="fu">ncol</span>(event), <span class="at">ncol =</span> n_hidden) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>h_to_o_assc_weights <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> n_hidden <span class="sc">*</span> <span class="fu">ncol</span>(target)), <span class="at">nrow =</span> n_hidden, <span class="at">ncol =</span> <span class="fu">ncol</span>(target)) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>hidden_baseline <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_hidden) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>output_baseline <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">ncol</span>(target)) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (epoch <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_epochs) {</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    training_order <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(event))</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    d_h_to_o <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> h_to_o_assc_weights</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    d_i_to_h <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> i_to_h_assc_weights</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    d_h_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> hidden_baseline</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    d_o_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> output_baseline</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> training_order) {</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Forward propagation (prediction)</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Note the use of `as.vector` to ensure result is a vector (not a matrix with a single row)</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        hidden_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(event[i,] <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        output_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(hidden_activation <span class="sc">%*%</span> h_to_o_assc_weights) <span class="sc">+</span> output_baseline)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute error at output layer</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        output_error <span class="ot">&lt;-</span> target[i,] <span class="sc">-</span> output_activation</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Back propagation (learning)</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Derivative of error with respect to output unit activation</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>        d_output_error <span class="ot">&lt;-</span> output_error <span class="sc">*</span> output_activation <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> output_activation)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Derivative of error with respect to hidden unit activation</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>        d_hidden_error <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(h_to_o_assc_weights <span class="sc">%*%</span> d_output_error) <span class="sc">*</span> hidden_activation <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> hidden_activation)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the associative weights between the hidden and output layers</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>        d_h_to_o <span class="ot">&lt;-</span> d_h_to_o <span class="sc">+</span> learning_rate <span class="sc">*</span> <span class="fu">outer</span>(hidden_activation, d_output_error)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the associative weights between the input and hidden layers</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        d_i_to_h <span class="ot">&lt;-</span> d_i_to_h <span class="sc">+</span> learning_rate <span class="sc">*</span> <span class="fu">outer</span>(event[i,], d_hidden_error)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the baseline of the output units</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>        d_o_baseline <span class="ot">&lt;-</span> learning_rate <span class="sc">*</span> d_output_error</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the baseline of the hidden units</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        d_h_baseline <span class="ot">&lt;-</span> learning_rate <span class="sc">*</span> d_hidden_error</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span>learn_by_epoch) {</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adjust weights</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>            i_to_h_assc_weights <span class="ot">&lt;-</span> i_to_h_assc_weights <span class="sc">+</span> d_i_to_h</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>            h_to_o_assc_weights <span class="ot">&lt;-</span> h_to_o_assc_weights <span class="sc">+</span> d_h_to_o</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>            hidden_baseline <span class="ot">&lt;-</span> hidden_baseline <span class="sc">+</span> d_h_baseline</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>            output_baseline <span class="ot">&lt;-</span> output_baseline <span class="sc">+</span> d_o_baseline</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Reset adjustment to zero</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>            d_h_to_o <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> h_to_o_assc_weights</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>            d_i_to_h <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> i_to_h_assc_weights</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>            d_h_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> hidden_baseline</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>            d_o_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> output_baseline</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (learn_by_epoch) {</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adjust weights</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>        i_to_h_assc_weights <span class="ot">&lt;-</span> i_to_h_assc_weights <span class="sc">+</span> d_i_to_h</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>        h_to_o_assc_weights <span class="ot">&lt;-</span> h_to_o_assc_weights <span class="sc">+</span> d_h_to_o</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>        hidden_baseline <span class="ot">&lt;-</span> hidden_baseline <span class="sc">+</span> d_h_baseline</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>        output_baseline <span class="ot">&lt;-</span> output_baseline <span class="sc">+</span> d_o_baseline</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (epoch <span class="sc">%in%</span> <span class="fu">as.numeric</span>(<span class="fu">dimnames</span>(snapshot_hidden_activation)[[<span class="dv">1</span>]])) {</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(event)) {</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>            snapshot_hidden_activation[<span class="fu">as.character</span>(epoch), i, ] <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(event[i,] <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a><span class="fu">array2DF</span>(snapshot_hidden_activation) <span class="sc">%&gt;%</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">item =</span> <span class="fu">factor</span>(item, <span class="at">levels =</span> <span class="fu">rownames</span>(event))) <span class="sc">%&gt;%</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hidden_unit =</span> <span class="fu">as.numeric</span>(hidden_unit)) <span class="sc">%&gt;%</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">epoch =</span> <span class="fu">factor</span>(epoch, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(epoch)))))) <span class="sc">%&gt;%</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hidden_unit, <span class="at">y =</span> Value, <span class="at">color =</span> item)) <span class="sc">+</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_okabeito</span>() <span class="sc">+</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="st">"epoch"</span>, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="backprop_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>item_mds <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(n_hidden_snapshots, <span class="fu">nrow</span>(event), <span class="dv">2</span>), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"epoch"</span> <span class="ot">=</span> epoch_to_snap, <span class="st">"item"</span> <span class="ot">=</span> <span class="fu">rownames</span>(event), <span class="st">"dim"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"dim"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (epoch <span class="cf">in</span> <span class="fu">dimnames</span>(snapshot_hidden_activation)[[<span class="dv">1</span>]]) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    item_mds[epoch, , ] <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(<span class="at">d =</span> <span class="fu">dist</span>(snapshot_hidden_activation[epoch,,]), <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">array2DF</span>(item_mds) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(epoch, item), <span class="at">names_from =</span> dim, <span class="at">values_from =</span> Value) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">item =</span> <span class="fu">factor</span>(item, <span class="at">levels =</span> <span class="fu">rownames</span>(event))) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">epoch =</span> <span class="fu">factor</span>(epoch, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(epoch)))))) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dim1, <span class="at">y =</span> dim2, <span class="at">color =</span> item)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_okabeito</span>() <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evolution of internal representations with learning"</span>, <span class="at">x =</span> <span class="st">"Dimension 1"</span>, <span class="at">y =</span> <span class="st">"Dimension 2"</span>, <span class="at">caption =</span> <span class="st">"Visualization by multidimensional scaling"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="backprop_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>transfer_event <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">ncol</span>(event))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(transfer_event) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(transfer_event) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(event)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>transfer_hidden_activation <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(transfer_event), <span class="at">ncol =</span> n_hidden, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">rownames</span>(transfer_event), <span class="dv">1</span><span class="sc">:</span>n_hidden))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>p_resp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(transfer_event), <span class="at">ncol =</span> <span class="fu">ncol</span>(target), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">rownames</span>(transfer_event), <span class="fu">colnames</span>(target)))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(transfer_event)) {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    transfer_hidden_activation[i,] <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(transfer_event[i,] <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    p_resp[i,] <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(transfer_hidden_activation[i,] <span class="sc">%*%</span> h_to_o_assc_weights) <span class="sc">+</span> output_baseline)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(p_resp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 19%">
<col style="width: 22%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">swollen_eyelids</th>
<th style="text-align: right;">splotchy_ears</th>
<th style="text-align: right;">discolored_gums</th>
<th style="text-align: right;">nosebleed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">swollen_eyelids</td>
<td style="text-align: right;">0.8942735</td>
<td style="text-align: right;">0.3141048</td>
<td style="text-align: right;">0.1306991</td>
<td style="text-align: right;">0.1301509</td>
</tr>
<tr class="even">
<td style="text-align: left;">splotchy_ears</td>
<td style="text-align: right;">0.0644822</td>
<td style="text-align: right;">0.9956340</td>
<td style="text-align: right;">0.0766419</td>
<td style="text-align: right;">0.0766610</td>
</tr>
<tr class="odd">
<td style="text-align: left;">discolored_gums</td>
<td style="text-align: right;">0.3069308</td>
<td style="text-align: right;">0.0945172</td>
<td style="text-align: right;">0.9869707</td>
<td style="text-align: right;">0.9869458</td>
</tr>
<tr class="even">
<td style="text-align: left;">nosebleed</td>
<td style="text-align: right;">0.3068504</td>
<td style="text-align: right;">0.0959893</td>
<td style="text-align: right;">0.9869667</td>
<td style="text-align: right;">0.9869420</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(transfer_hidden_activation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">1</th>
<th style="text-align: right;">2</th>
<th style="text-align: right;">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">swollen_eyelids</td>
<td style="text-align: right;">0.0599611</td>
<td style="text-align: right;">0.0086411</td>
<td style="text-align: right;">0.0845510</td>
</tr>
<tr class="even">
<td style="text-align: left;">splotchy_ears</td>
<td style="text-align: right;">0.0468187</td>
<td style="text-align: right;">0.9518634</td>
<td style="text-align: right;">0.0275678</td>
</tr>
<tr class="odd">
<td style="text-align: left;">discolored_gums</td>
<td style="text-align: right;">0.9654033</td>
<td style="text-align: right;">0.4996647</td>
<td style="text-align: right;">0.8173764</td>
</tr>
<tr class="even">
<td style="text-align: left;">nosebleed</td>
<td style="text-align: right;">0.9660011</td>
<td style="text-align: right;">0.5010516</td>
<td style="text-align: right;">0.8161011</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>By cuing the hidden layer with a single symptom at a time, we can obtain what is, in essence, a “factor loading matrix”. Specifically, by examining how each hidden unit is activated by each feature, we see how strongly that feature is associated with each hidden unit. Each hidden unit can then be thought of as analogous to a “latent factor” that the network has learned, which enables it to correctly reproduce the input. This feature of autoencoders makes them robust to noise in the input.</p>
</section>
<section id="simple-recurrent-networks-learning-patterns-in-time" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="simple-recurrent-networks-learning-patterns-in-time"><span class="header-section-number">12.4</span> Simple recurrent networks: Learning patterns in time</h2>
<p>One of the most interesting (in my opinion) applications of backprop networks comes in the form of <em>simple recurrent networks (SRN)</em>. These were described by <span class="citation" data-cites="Elman1990">(<a href="references.html#ref-Elman1990" role="doc-biblioref"><strong>Elman1990?</strong></a>)</span>, who showed that they could learn <strong>structure in time</strong>. These models are applied to <em>sequences</em>, where the current event in the sequence is treated as “input” and the next event is the target at the output layer. Thus, these networks are explicitly trained to predict the future.</p>
<p>In principle, the same model structure we’ve seen so far could work here too. But <span class="citation" data-cites="Elman1990">(<a href="references.html#ref-Elman1990" role="doc-biblioref"><strong>Elman1990?</strong></a>)</span> proposed an interesting change: The input on each step of the sequence isn’t <em>just</em> the current event—it is also the vector of hidden unit activation from the <em>previous</em> step of the sequence. Thus, the networks own prior state is treated as input for the purpose of making a prediction. This means that the hidden unit representations learned by the network must pull “double duty”—they need to learn, in essence, how to serve as useful memory representations.</p>
<section id="learning-to-have-memory" class="level3" data-number="12.4.1">
<h3 data-number="12.4.1" class="anchored" data-anchor-id="learning-to-have-memory"><span class="header-section-number">12.4.1</span> Learning to have memory</h3>
<p><span class="citation" data-cites="Elman">(<a href="references.html#ref-Elman" role="doc-biblioref"><strong>Elman?</strong></a>)</span> gave a simple illustration of an SRN learning to have memory. In the following example, each event has just a single dimension—it can be <code>0</code> or <code>1</code>. Sequences are comprised of three-element subsequences. Within each subsequence, the final element is the “exclusive-or” (XOR) of the previous two elements. Specifically, the final element is <code>1</code> if the previous two elements are different and it is <code>0</code> if the previous two elements are the same. These three-element subsequences are randomly concatenated to form a long exposure sequence.</p>
<p>This is a challenging pattern to learn! In many cases, it will be impossible to predict the next element. Imagine that the sequence <code>0, 1, 1</code> occurs. When the first element occurs, it is not possible to predict what the second one will be. However, once the second element occurs, it <em>is</em> possible to predict the third element, since it follows the XOR rule. But once the third element occurs, it is again impossible to predict the next element, since the next element is the start of the next sequence. Only for the second element of a sequence is it possible to make a reasonable prediction about the next element. And that’s only if you (a) can remember far enough back; and (b) have learned the XOR rule.</p>
<p>This learning situation can be thought of as a microcosm for learning the structure of events more generally. For example, if a pitcher throws a ball, we cannot predict whether the batter will hit it. But once we know whether the batter has hit the ball or not, we can form some expectation about what will happen next. But then the next pitch is unpredictable once again.</p>
<p>The code below implements a version of Elman’s XOR sequence task. The network only has 2 hidden units. It learns in batches, where each batch is a long sequence built by concatenating many 3-element subsequences, each of which follow the XOR rule.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>logistic_act <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>x)))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Each row is a subsequence from which the whole training sequence will be built.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The number refer to the rows in the "representations" matrix below.</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>subsequences <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>representations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># On each epoch, the model learns on a new randomly generated training sequence</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>n_epochs <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the number of times each subsequence will occur in each training sequence</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>n_per_subsequence <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>n_hidden <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>i_to_h_assc_weights <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> (<span class="fu">ncol</span>(representations) <span class="sc">+</span> n_hidden) <span class="sc">*</span> n_hidden), <span class="at">nrow =</span> <span class="fu">ncol</span>(representations) <span class="sc">+</span> n_hidden, <span class="at">ncol =</span> n_hidden) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>h_to_o_assc_weights <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> n_hidden <span class="sc">*</span> <span class="fu">ncol</span>(representations)), <span class="at">nrow =</span> n_hidden, <span class="at">ncol =</span> <span class="fu">ncol</span>(representations)) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>hidden_baseline <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_hidden) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>output_baseline <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">ncol</span>(representations)) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (epoch <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_epochs) {</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    training_sequence <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(subsequences[<span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(subsequences), <span class="at">each =</span> n_per_subsequence)),]))</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    event <span class="ot">&lt;-</span> representations[training_sequence[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(training_sequence) <span class="sc">-</span> <span class="dv">1</span>)], , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    target <span class="ot">&lt;-</span> representations[training_sequence[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(training_sequence)], , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    d_h_to_o <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> h_to_o_assc_weights</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    d_i_to_h <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> i_to_h_assc_weights</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    d_h_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> hidden_baseline</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    d_o_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> output_baseline</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    prev_hidden_activation <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_hidden)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(event)) {</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Forward propagation (prediction)</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        this_input <span class="ot">&lt;-</span> <span class="fu">c</span>(event[i,], prev_hidden_activation)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        hidden_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(this_input <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        output_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(hidden_activation <span class="sc">%*%</span> h_to_o_assc_weights) <span class="sc">+</span> output_baseline)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute error at output layer</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        output_error <span class="ot">&lt;-</span> target[i,] <span class="sc">-</span> output_activation</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Back propagation (learning)</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Derivative of error with respect to output unit activation</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        d_output_error <span class="ot">&lt;-</span> output_error <span class="sc">*</span> output_activation <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> output_activation)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Derivative of error with respect to hidden unit activation</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>        d_hidden_error <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(h_to_o_assc_weights <span class="sc">%*%</span> d_output_error) <span class="sc">*</span> hidden_activation <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> hidden_activation)</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the associative weights between the hidden and output layers</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>        d_h_to_o <span class="ot">&lt;-</span> d_h_to_o <span class="sc">+</span> learning_rate <span class="sc">*</span> <span class="fu">outer</span>(hidden_activation, d_output_error)</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the associative weights between the input and hidden layers</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>        d_i_to_h <span class="ot">&lt;-</span> d_i_to_h <span class="sc">+</span> learning_rate <span class="sc">*</span> <span class="fu">outer</span>(this_input, d_hidden_error)</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the baseline of the output units</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        d_o_baseline <span class="ot">&lt;-</span> learning_rate <span class="sc">*</span> d_output_error</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the baseline of the hidden units</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>        d_h_baseline <span class="ot">&lt;-</span> learning_rate <span class="sc">*</span> d_hidden_error</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Copy hidden unit activation</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        prev_hidden_activation <span class="ot">&lt;-</span> hidden_activation</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust weights</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    i_to_h_assc_weights <span class="ot">&lt;-</span> i_to_h_assc_weights <span class="sc">+</span> d_i_to_h</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    h_to_o_assc_weights <span class="ot">&lt;-</span> h_to_o_assc_weights <span class="sc">+</span> d_h_to_o</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    hidden_baseline <span class="ot">&lt;-</span> hidden_baseline <span class="sc">+</span> d_h_baseline</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    output_baseline <span class="ot">&lt;-</span> output_baseline <span class="sc">+</span> d_o_baseline</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>transfer_sequence <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(subsequences[<span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(subsequences), <span class="at">each =</span> n_per_subsequence)),]))</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> representations[transfer_sequence[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(transfer_sequence) <span class="sc">-</span> <span class="dv">1</span>)], , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> representations[transfer_sequence[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(transfer_sequence)], , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>transfer_error <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(event))</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>prev_hidden_activation <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_hidden)</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(event)) {</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>    this_input <span class="ot">&lt;-</span> <span class="fu">c</span>(event[i,], prev_hidden_activation)</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>    hidden_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(this_input <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    output_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(hidden_activation <span class="sc">%*%</span> h_to_o_assc_weights) <span class="sc">+</span> output_baseline)</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    transfer_error[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((target[i,] <span class="sc">-</span> output_activation)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    prev_hidden_activation <span class="ot">&lt;-</span> hidden_activation</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">step =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(event), <span class="at">error =</span> transfer_error) <span class="sc">%&gt;%</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sub_step =</span> ((step <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> <span class="fu">ncol</span>(subsequences)) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sub_step, <span class="at">y =</span> error)) <span class="sc">+</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_cl_normal) <span class="sc">+</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Position within subsequence"</span>, <span class="at">y =</span> <span class="st">"Root mean squared prediction error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="backprop_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As we can see, once trained, the network shows exactly the “dip” in prediction error that we would expect if the network (a) could use its hidden layer to retain memory sufficient for the task; and (b) had learned the XOR pattern.</p>
</section>
<section id="learning-concept-representations-by-prediction" class="level3" data-number="12.4.2">
<h3 data-number="12.4.2" class="anchored" data-anchor-id="learning-concept-representations-by-prediction"><span class="header-section-number">12.4.2</span> Learning concept representations by prediction</h3>
<p>The following illustrates how the same SRN model structure can learn to distinguish between more complex concepts based on how they occur within “sentences” of a “language”. Specifically, the network will be presented with a sequence consisting of concatenated subsequences, each of which is three elements long. These elements comprise “sentences” following a “subject-verb-object” frame. Only some items can serve as each category, some subjects can engage in different verbs, and some objects can only receive certain verbs.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>logistic_act <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>x)))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Each row is a subsequence from which the whole training sequence will</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># be built.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>subsequences <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">3</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">2</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">3</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">3</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">4</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">1</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">3</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">3</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="co"># (only the dog can throw the door)</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">4</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">15</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>representations <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">8</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(representations) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(representations) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"door"</span>, <span class="st">"rock"</span>, <span class="st">"see"</span>, <span class="st">"hear"</span>, <span class="st">"use"</span>, <span class="st">"throw"</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># On each epoch, the model learns on a new randomly generated training sequence</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>n_epochs <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the number of times each subsequence will occur in each training sequence</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>n_per_subsequence <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>n_hidden <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>n_hidden_snapshots <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>epoch_to_snap <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">log</span>(n_epochs), <span class="at">length.out =</span> n_hidden_snapshots)))</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>snapshot_hidden_activation <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(n_hidden_snapshots, <span class="fu">nrow</span>(representations), n_hidden), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"epoch"</span> <span class="ot">=</span> epoch_to_snap, <span class="st">"item"</span> <span class="ot">=</span> <span class="fu">rownames</span>(representations), <span class="st">"hidden_unit"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n_hidden))</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>i_to_h_assc_weights <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> (<span class="fu">ncol</span>(representations) <span class="sc">+</span> n_hidden) <span class="sc">*</span> n_hidden), <span class="at">nrow =</span> <span class="fu">ncol</span>(representations) <span class="sc">+</span> n_hidden, <span class="at">ncol =</span> n_hidden) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>h_to_o_assc_weights <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> n_hidden <span class="sc">*</span> <span class="fu">ncol</span>(representations)), <span class="at">nrow =</span> n_hidden, <span class="at">ncol =</span> <span class="fu">ncol</span>(representations)) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>hidden_baseline <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_hidden) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>output_baseline <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">ncol</span>(representations)) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (epoch <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_epochs) {</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    training_sequence <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(subsequences[<span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(subsequences), <span class="at">each =</span> n_per_subsequence)),]))</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    event <span class="ot">&lt;-</span> representations[training_sequence[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(training_sequence) <span class="sc">-</span> <span class="dv">1</span>)], , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    target <span class="ot">&lt;-</span> representations[training_sequence[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(training_sequence)], , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    d_h_to_o <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> h_to_o_assc_weights</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    d_i_to_h <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> i_to_h_assc_weights</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    d_h_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> hidden_baseline</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    d_o_baseline <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> output_baseline</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    prev_hidden_activation <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_hidden)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(event)) {</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Forward propagation (prediction)</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>        this_input <span class="ot">&lt;-</span> <span class="fu">c</span>(event[i,], prev_hidden_activation)</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>        hidden_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(this_input <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>        output_activation <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(hidden_activation <span class="sc">%*%</span> h_to_o_assc_weights) <span class="sc">+</span> output_baseline)</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute error at output layer</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>        output_error <span class="ot">&lt;-</span> target[i,] <span class="sc">-</span> output_activation</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Back propagation (learning)</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Derivative of error with respect to output unit activation</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        d_output_error <span class="ot">&lt;-</span> output_error <span class="sc">*</span> output_activation <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> output_activation)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Derivative of error with respect to hidden unit activation</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>        d_hidden_error <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(h_to_o_assc_weights <span class="sc">%*%</span> d_output_error) <span class="sc">*</span> hidden_activation <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> hidden_activation)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the associative weights between the hidden and output layers</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>        d_h_to_o <span class="ot">&lt;-</span> d_h_to_o <span class="sc">+</span> learning_rate <span class="sc">*</span> <span class="fu">outer</span>(hidden_activation, d_output_error)</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the associative weights between the input and hidden layers</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>        d_i_to_h <span class="ot">&lt;-</span> d_i_to_h <span class="sc">+</span> learning_rate <span class="sc">*</span> <span class="fu">outer</span>(this_input, d_hidden_error)</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the baseline of the output units</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        d_o_baseline <span class="ot">&lt;-</span> learning_rate <span class="sc">*</span> d_output_error</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much to adjust the baseline of the hidden units</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>        d_h_baseline <span class="ot">&lt;-</span> learning_rate <span class="sc">*</span> d_hidden_error</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Copy hidden unit activation</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>        prev_hidden_activation <span class="ot">&lt;-</span> hidden_activation</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust weights</span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>    i_to_h_assc_weights <span class="ot">&lt;-</span> i_to_h_assc_weights <span class="sc">+</span> d_i_to_h</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>    h_to_o_assc_weights <span class="ot">&lt;-</span> h_to_o_assc_weights <span class="sc">+</span> d_h_to_o</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    hidden_baseline <span class="ot">&lt;-</span> hidden_baseline <span class="sc">+</span> d_h_baseline</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>    output_baseline <span class="ot">&lt;-</span> output_baseline <span class="sc">+</span> d_o_baseline</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (epoch <span class="sc">%in%</span> <span class="fu">as.numeric</span>(<span class="fu">dimnames</span>(snapshot_hidden_activation)[[<span class="dv">1</span>]])) {</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>        prev_hidden_activation <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_hidden)</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(representations)) {</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>            snapshot_hidden_activation[<span class="fu">as.character</span>(epoch), i, ] <span class="ot">&lt;-</span> <span class="fu">logistic_act</span>(<span class="fu">as.vector</span>(<span class="fu">c</span>(representations[i,], prev_hidden_activation) <span class="sc">%*%</span> i_to_h_assc_weights) <span class="sc">+</span> hidden_baseline)</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a><span class="fu">array2DF</span>(snapshot_hidden_activation) <span class="sc">%&gt;%</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">item =</span> <span class="fu">factor</span>(item, <span class="at">levels =</span> <span class="fu">rownames</span>(representations))) <span class="sc">%&gt;%</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hidden_unit =</span> <span class="fu">as.numeric</span>(hidden_unit)) <span class="sc">%&gt;%</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">epoch =</span> <span class="fu">factor</span>(epoch, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(epoch)))))) <span class="sc">%&gt;%</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hidden_unit, <span class="at">y =</span> Value, <span class="at">color =</span> item)) <span class="sc">+</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Paired"</span>) <span class="sc">+</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="st">"epoch"</span>, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="backprop_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>item_mds <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(n_hidden_snapshots, <span class="fu">nrow</span>(representations), <span class="dv">2</span>), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"epoch"</span> <span class="ot">=</span> epoch_to_snap, <span class="st">"item"</span> <span class="ot">=</span> <span class="fu">rownames</span>(representations), <span class="st">"dim"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"dim"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (epoch <span class="cf">in</span> <span class="fu">dimnames</span>(snapshot_hidden_activation)[[<span class="dv">1</span>]]) {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    item_mds[epoch, , ] <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(<span class="at">d =</span> <span class="fu">dist</span>(snapshot_hidden_activation[epoch,,]), <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">array2DF</span>(item_mds) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(epoch, item), <span class="at">names_from =</span> dim, <span class="at">values_from =</span> Value) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">item =</span> <span class="fu">factor</span>(item, <span class="at">levels =</span> <span class="fu">rownames</span>(representations))) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">epoch =</span> <span class="fu">factor</span>(epoch, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(epoch)))))) <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dim1, <span class="at">y =</span> dim2, <span class="at">color =</span> item)) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Paired"</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evolution of internal representations with learning"</span>, <span class="at">x =</span> <span class="st">"Dimension 1"</span>, <span class="at">y =</span> <span class="st">"Dimension 2"</span>, <span class="at">caption =</span> <span class="st">"Visualization by multidimensional scaling"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="backprop_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-McClellandEtAl1995" class="csl-entry" role="listitem">
McClelland, J. L., McNaughton, B. L., &amp; O’Reilly, R. C. (1995). Why there are complementary learning systems in the hippocampus and neocortex: Insights from the successes and failures of connectionist models of learning and memory. <em>Psychological Review</em>, <em>102</em>(3), 419–457.
</div>
<div id="ref-RogersMcClelland2004" class="csl-entry" role="listitem">
Rogers, T. T., &amp; McClelland, J. L. (2004). <em>Semantic cognition: A parallel distributed processing approach</em>. MIT Press.
</div>
<div id="ref-RumelhartHintonWilliams1986" class="csl-entry" role="listitem">
Rumelhart, D. E., Hinton, G. E., &amp; Williams, R. J. (1986). Learning internal representations by error propagation. In D. E. Rumelhart &amp; J. L. McClelland (Eds.), <em>Parallel distributed processing: Vol. I</em>. The MIT Press.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./learning.html" class="pagination-link" aria-label="Associative Learning">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Associative Learning</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>